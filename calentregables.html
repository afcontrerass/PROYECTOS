<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduTask - Calificar Entregables</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Estilos específicos para la página de calificación */
        .filter-section {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }
        
        .submissions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .submissions-table th,
        .submissions-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .submissions-table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }
        
        .submissions-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-submitted {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-graded {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-late {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-grade {
            background-color: #007bff;
            color: white;
        }
        
        .btn-view {
            background-color: #6c757d;
            color: white;
        }
        
        .grade-input {
            width: 70px;
            padding: 6px;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        
        .comments-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            resize: vertical;
            min-height: 80px;
        }
        
        /* Estilos para los filtros del dashboard */
        .dashboard-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-card {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-card select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background-color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="site-header">
            <div class="logo">
                <a href="/indexdocente.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit">
                    <img src="logo.png" alt="Logo" style="height:40px;object-fit:contain">
                    <h1 style="font-size:20px;margin:0">PROJECT MANAGEMENT</h1>
                </a>
            </div>

            <div class="user-actions">
                <div class="notification-bell" id="notificationBell">
                    <i class="far fa-bell"></i>
                    <span class="notification-count">0</span>
                    <div class="notification-panel" id="notificationPanel"></div>
                </div>

                <div class="user-profile">
                    <div class="avatar" id="avatar">U</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">-</div>
                        <div class="user-role" id="userRole">-</div>
                        <button id="logoutBtn" style="margin-left:10px;padding:6px 10px;border-radius:6px;">Cerrar sesión</button>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <ul class="sidebar-menu">
                    <li>
                        <i class="fas fa-home"></i>
                        <span><a href="indexdocente.html">inicio</a></span>
                    </li>
                    <li>
                        <i class="fas fa-upload"></i>
                        <span><a href="proyectosdocente.html">proyectos</a></span>
                    </li>
                    <li>
                        <i class="fas fa-calendar-alt"></i>
                        <span><a href="calendariodocente.html">calendario</a></span>
                    </li>
                    <li class="active">
                        <i class="fas fa-chart-bar"></i>
                        <span><a href="calificacionesdocente.html">calificaciones</a></span>
                    </li>
                    <li>
                        <i class="fas fa-cog"></i>
                        <span><a href="configuraciondocente.html">Configuración</a></span>
                    </li>
                </ul>
            </div>
            
            <div class="content">
                <h1>Calificar Entregables</h1>
                
                <!-- Filtros para el dashboard -->
                <div class="dashboard-filters">
                    <div class="filter-card">
                        <label for="filterCourse">Curso</label>
                        <select id="filterCourse">
                            <option value="">Todos los cursos</option>
                            <option value="math">Matemáticas</option>
                            <option value="science">Ciencias</option>
                            <option value="history">Historia</option>
                            <option value="language">Lenguaje</option>
                        </select>
                    </div>
                    <div class="filter-card">
                        <label for="filterStatus">Estado</label>
                        <select id="filterStatus">
                            <option value="">Todos los estados</option>
                            <option value="pending">Pendientes</option>
                            <option value="submitted">Entregados</option>
                            <option value="graded">Calificados</option>
                            <option value="late">Atrasados</option>
                        </select>
                    </div>
                    <div class="filter-card">
                        <label for="filterDate">Fecha de entrega</label>
                        <select id="filterDate">
                            <option value="">Todas las fechas</option>
                            <option value="week">Esta semana</option>
                            <option value="month">Este mes</option>
                            <option value="overdue">Vencidas</option>
                        </select>
                    </div>
                </div>
                
                <!-- Dashboard cards con filtros aplicados -->
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3>Tareas por calificar</h3>
                            <div class="card-icon bg-primary">
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                        </div>
                        <div class="card-value" id="pendingTasks">8</div>
                        <div class="card-text">Pendientes de revisión</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Alumnos inscritos</h3>
                            <div class="card-icon bg-success">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="card-value" id="enrolledStudents">120</div>
                        <div class="card-text">Activos en project</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Proyectos en curso</h3>
                            <div class="card-icon bg-warning">
                                <i class="fas fa-tasks"></i>
                            </div>
                        </div>
                        <div class="card-value" id="activeProjects">4</div>
                        <div class="card-text">numero total de proyectos</div>
                    </div>
                </div>
                
                <!-- Sección de filtros para entregables -->
                <div class="filter-section">
                    <h3>Filtrar Entregables</h3>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="assignmentFilter">Tarea/Proyecto</label>
                            <select id="assignmentFilter">
                                <option value="">Todas las tareas</option>
                                <option value="math-algebra">Matemáticas - Álgebra</option>
                                <option value="history-essay">Historia - Ensayo</option>
                                <option value="physics-lab">Física - Laboratorio</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="studentFilter">Estudiante</label>
                            <select id="studentFilter">
                                <option value="">Todos los estudiantes</option>
                                <option value="student1">Juan Pérez</option>
                                <option value="student2">María García</option>
                                <option value="student3">Carlos López</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="statusFilter">Estado de entrega</label>
                            <select id="statusFilter">
                                <option value="">Todos los estados</option>
                                <option value="pending">Pendiente</option>
                                <option value="submitted">Entregado</option>
                                <option value="graded">Calificado</option>
                                <option value="late">Atrasado</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-secondary" id="resetFilters">
                            <i class="fas fa-redo"></i> Restablecer
                        </button>
                        <button class="btn btn-primary" id="applyFilters">
                            <i class="fas fa-filter"></i> Aplicar Filtros
                        </button>
                    </div>
                </div>
                
                <!-- Tabla de entregables -->
                <div class="table-container">
                    <table class="submissions-table">
                        <thead>
                            <tr>
                                <th>Estudiante</th>
                                <th>Tarea</th>
                                <th>Fecha de Entrega</th>
                                <th>Estado</th>
                                <th>Calificación</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="submissionsTableBody">
                            <!-- Las filas se llenarán con JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para calificar entregable -->
    <div class="modal" id="gradeModal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-modal">&times;</span>
            
            <div class="modal-header">
                <h2>Calificar Entregable</h2>
            </div>
            
            <div class="modal-body">
                <div class="submission-info">
                    <h4 id="submissionStudentName">-</h4>
                    <p id="submissionAssignment">-</p>
                    <p id="submissionDate">-</p>
                    <div id="submissionFiles" class="file-list"></div>
                </div>
                
                <form id="gradeForm">
                    <input type="hidden" id="submissionId">
                    
                    <div class="form-group">
                        <label for="gradeValue">Calificación (0-10)</label>
                        <input type="number" class="grade-input" id="gradeValue" min="0" max="10" step="0.1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="gradeComments">Comentarios</label>
                        <textarea class="comments-input" id="gradeComments" placeholder="Agregar comentarios sobre la entrega..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelGrade">Cancelar</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Guardar Calificación
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="header.js"></script>
    <script>
        // Datos de ejemplo para las entregas
        const submissionsData = [
            {
                id: 1,
                studentName: "Juan Pérez",
                assignment: "Matemáticas - Álgebra",
                dueDate: "2023-06-15",
                submittedDate: "2023-06-14",
                status: "submitted",
                grade: null,
                files: ["ejercicios_algebra.pdf"]
            },
            {
                id: 2,
                studentName: "María García",
                assignment: "Historia - Ensayo",
                dueDate: "2023-06-12",
                submittedDate: "2023-06-13",
                status: "late",
                grade: null,
                files: ["ensayo_revolucion.docx"]
            },
            {
                id: 3,
                studentName: "Carlos López",
                assignment: "Física - Laboratorio",
                dueDate: "2023-06-05",
                submittedDate: "2023-06-04",
                status: "graded",
                grade: 9.5,
                files: ["informe_laboratorio.pdf"]
            },
            {
                id: 4,
                studentName: "Ana Martínez",
                assignment: "Matemáticas - Álgebra",
                dueDate: "2023-06-15",
                submittedDate: null,
                status: "pending",
                grade: null,
                files: []
            }
        ];

        // Elementos del DOM
        const submissionsTableBody = document.getElementById('submissionsTableBody');
        const gradeModal = document.getElementById('gradeModal');
        const gradeForm = document.getElementById('gradeForm');
        const closeModalBtn = document.querySelector('.close-modal');
        const cancelGradeBtn = document.getElementById('cancelGrade');
        const applyFiltersBtn = document.getElementById('applyFilters');
        const resetFiltersBtn = document.getElementById('resetFilters');

        // Cargar datos en la tabla
        function loadSubmissionsTable(data = submissionsData) {
            submissionsTableBody.innerHTML = '';
            
            data.forEach(submission => {
                const row = document.createElement('tr');
                
                // Determinar el estado y la clase CSS
                let statusText, statusClass;
                if (submission.status === 'pending') {
                    statusText = 'Pendiente';
                    statusClass = 'status-pending';
                } else if (submission.status === 'submitted') {
                    statusText = 'Entregado';
                    statusClass = 'status-submitted';
                } else if (submission.status === 'graded') {
                    statusText = 'Calificado';
                    statusClass = 'status-graded';
                } else if (submission.status === 'late') {
                    statusText = 'Atrasado';
                    statusClass = 'status-late';
                }
                
                // Determinar la fecha a mostrar
                let dateText;
                if (submission.status === 'pending') {
                    dateText = `Vence: ${formatDate(submission.dueDate)}`;
                } else if (submission.status === 'late') {
                    dateText = `Vencido: ${formatDate(submission.dueDate)}`;
                } else {
                    dateText = `Entregado: ${formatDate(submission.submittedDate)}`;
                }
                
                // Determinar la calificación a mostrar
                let gradeText = submission.grade !== null ? submission.grade : '-';
                
                row.innerHTML = `
                    <td>${submission.studentName}</td>
                    <td>${submission.assignment}</td>
                    <td>${dateText}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>${gradeText}</td>
                    <td>
                        ${submission.status === 'submitted' || submission.status === 'late' ? 
                            `<button class="action-btn btn-grade" data-id="${submission.id}">
                                <i class="fas fa-edit"></i> Calificar
                            </button>` : 
                            ''}
                        ${submission.files.length > 0 ? 
                            `<button class="action-btn btn-view" data-id="${submission.id}">
                                <i class="fas fa-eye"></i> Ver
                            </button>` : 
                            ''}
                    </td>
                `;
                
                submissionsTableBody.appendChild(row);
            });
            
            // Agregar event listeners a los botones
            document.querySelectorAll('.btn-grade').forEach(btn => {
                btn.addEventListener('click', function() {
                    const submissionId = this.getAttribute('data-id');
                    openGradeModal(submissionId);
                });
            });
            
            document.querySelectorAll('.btn-view').forEach(btn => {
                btn.addEventListener('click', function() {
                    const submissionId = this.getAttribute('data-id');
                    viewSubmission(submissionId);
                });
            });
        }

        // Formatear fecha
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES');
        }

        // Abrir modal de calificación
        function openGradeModal(submissionId) {
            const submission = submissionsData.find(s => s.id == submissionId);
            if (!submission) return;
            
            document.getElementById('submissionId').value = submission.id;
            document.getElementById('submissionStudentName').textContent = submission.studentName;
            document.getElementById('submissionAssignment').textContent = submission.assignment;
            document.getElementById('submissionDate').textContent = `Entregado: ${formatDate(submission.submittedDate)}`;
            
            // Limpiar y llenar lista de archivos
            const fileList = document.getElementById('submissionFiles');
            fileList.innerHTML = '';
            
            if (submission.files.length > 0) {
                const fileTitle = document.createElement('p');
                fileTitle.textContent = 'Archivos:';
                fileList.appendChild(fileTitle);
                
                submission.files.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.innerHTML = `<i class="fas fa-file"></i> ${file}`;
                    fileList.appendChild(fileItem);
                });
            } else {
                fileList.innerHTML = '<p>No hay archivos adjuntos</p>';
            }
            
            // Establecer valores del formulario
            document.getElementById('gradeValue').value = submission.grade || '';
            document.getElementById('gradeComments').value = '';
            
            // Mostrar modal
            gradeModal.style.display = 'block';
        }

        // Ver entrega (simulación)
        function viewSubmission(submissionId) {
            const submission = submissionsData.find(s => s.id == submissionId);
            if (!submission) return;
            
            alert(`Visualizando entrega de ${submission.studentName} para ${submission.assignment}`);
            // En una implementación real, aquí se abriría un visor de archivos o se descargarían los archivos
        }

        // Cerrar modal
        function closeModal() {
            gradeModal.style.display = 'none';
        }

        // Aplicar filtros
        function applyFilters() {
            const assignmentFilter = document.getElementById('assignmentFilter').value;
            const studentFilter = document.getElementById('studentFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            let filteredData = submissionsData;
            
            if (assignmentFilter) {
                filteredData = filteredData.filter(submission => 
                    submission.assignment.toLowerCase().includes(assignmentFilter.toLowerCase())
                );
            }
            
            if (studentFilter) {
                filteredData = filteredData.filter(submission => 
                    submission.studentName.toLowerCase().includes(studentFilter.toLowerCase())
                );
            }
            
            if (statusFilter) {
                filteredData = filteredData.filter(submission => submission.status === statusFilter);
            }
            
            loadSubmissionsTable(filteredData);
            
            // Actualizar contadores del dashboard
            updateDashboardCounters(filteredData);
        }

        // Restablecer filtros
        function resetFilters() {
            document.getElementById('assignmentFilter').value = '';
            document.getElementById('studentFilter').value = '';
            document.getElementById('statusFilter').value = '';
            
            loadSubmissionsTable();
            updateDashboardCounters(submissionsData);
        }

        // Actualizar contadores del dashboard
        function updateDashboardCounters(data) {
            const pendingTasks = data.filter(s => s.status === 'submitted' || s.status === 'late').length;
            document.getElementById('pendingTasks').textContent = pendingTasks;
            
            // En una implementación real, estos valores vendrían de la base de datos
            // Por ahora, mantenemos los valores originales o los ajustamos según los filtros
            const enrolledStudents = new Set(data.map(s => s.studentName)).size;
            document.getElementById('enrolledStudents').textContent = enrolledStudents;
            
            const activeProjects = new Set(data.map(s => s.assignment)).size;
            document.getElementById('activeProjects').textContent = activeProjects;
        }

        // Enviar calificación (simulación de envío a base de datos)
        function submitGrade(event) {
            event.preventDefault();
            
            const submissionId = document.getElementById('submissionId').value;
            const gradeValue = parseFloat(document.getElementById('gradeValue').value);
            const comments = document.getElementById('gradeComments').value;
            
            // Validar calificación
            if (isNaN(gradeValue) || gradeValue < 0 || gradeValue > 10) {
                alert('Por favor, ingresa una calificación válida entre 0 y 10');
                return;
            }
            
            // Encontrar la entrega en los datos
            const submissionIndex = submissionsData.findIndex(s => s.id == submissionId);
            if (submissionIndex === -1) return;
            
            // Actualizar datos (en una implementación real, esto se enviaría al servidor)
            submissionsData[submissionIndex].grade = gradeValue;
            submissionsData[submissionIndex].status = 'graded';
            submissionsData[submissionIndex].comments = comments;
            
            // Mostrar mensaje de éxito
            alert(`Calificación ${gradeValue} guardada para ${submissionsData[submissionIndex].studentName}`);
            
            // Cerrar modal y actualizar tabla
            closeModal();
            loadSubmissionsTable();
            updateDashboardCounters(submissionsData);
            
            // En una implementación real, aquí se haría una llamada AJAX para guardar en la base de datos
            /*
            fetch('/api/grade-submission', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    submissionId: submissionId,
                    grade: gradeValue,
                    comments: comments
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Calificación guardada exitosamente');
                    closeModal();
                    loadSubmissionsTable();
                } else {
                    alert('Error al guardar la calificación: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al guardar la calificación');
            });
            */
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadSubmissionsTable();
            
            // Filtros del dashboard
            document.getElementById('filterCourse').addEventListener('change', applyFilters);
            document.getElementById('filterStatus').addEventListener('change', applyFilters);
            document.getElementById('filterDate').addEventListener('change', applyFilters);
            
            // Filtros de entregables
            applyFiltersBtn.addEventListener('click', applyFilters);
            resetFiltersBtn.addEventListener('click', resetFilters);
            
            // Modal de calificación
            closeModalBtn.addEventListener('click', closeModal);
            cancelGradeBtn.addEventListener('click', closeModal);
            gradeForm.addEventListener('submit', submitGrade);
            
            // Cerrar modal al hacer clic fuera de él
            window.addEventListener('click', function(event) {
                if (event.target === gradeModal) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>