// dashboard.js - Funcionalidad para actualizar los cards del dashboard
class DashboardManager {
    constructor() {
        this.stats = {
            tareasPendientes: 0,
            alumnosInscritos: 0,
            proyectosCurso: 0
        };
    }

    async loadDashboardData() {
        try {
            console.log('üìä Cargando datos del dashboard...');
            
            // Cargar estad√≠sticas de tareas
            await this.loadTaskStats();
            
            // Cargar estad√≠sticas de proyectos
            await this.loadProjectStats();
            
            // Actualizar la UI
            this.updateDashboardCards();
            
        } catch (error) {
            console.error('‚ùå Error cargando datos del dashboard:', error);
        }
    }

    async loadTaskStats() {
        try {
            const response = await fetch('/api/tareas');
            if (!response.ok) throw new Error('Error al obtener tareas');
            
            const tareas = await response.json();
            
            // Contar tareas por estado
            this.stats.tareasPendientes = tareas.filter(t => 
                t.estado === 'pendiente' || t.estado === 'urgente'
            ).length;
            
            console.log(`‚úÖ Tareas cargadas: ${tareas.length}, Pendientes: ${this.stats.tareasPendientes}`);
            
        } catch (error) {
            console.error('‚ùå Error cargando estad√≠sticas de tareas:', error);
            this.stats.tareasPendientes = 0;
        }
    }

    async loadProjectStats() {
        try {
            const response = await fetch('/api/proyectos');
            if (!response.ok) throw new Error('Error al obtener proyectos');
            
            const proyectos = await response.json();
            
            // Contar proyectos activos
            this.stats.proyectosCurso = proyectos.filter(p => 
                p.estado === 'activo'
            ).length;
            
            // Para alumnos inscritos, podr√≠as tener una API espec√≠fica
            // Por ahora usamos un valor por defecto o de sesi√≥n
            this.stats.alumnosInscritos = await this.getStudentCount();
            
            console.log(`‚úÖ Proyectos cargados: ${proyectos.length}, Activos: ${this.stats.proyectosCurso}`);
            
        } catch (error) {
            console.error('‚ùå Error cargando estad√≠sticas de proyectos:', error);
            this.stats.proyectosCurso = 0;
            this.stats.alumnosInscritos = 0;
        }
    }

    async getStudentCount() {
        try {
            // Esta ser√≠a una API espec√≠fica para contar estudiantes
            // Por ahora retornamos un valor por defecto
            return 120; // Puedes implementar la l√≥gica real aqu√≠
        } catch (error) {
            console.error('Error obteniendo conteo de estudiantes:', error);
            return 0;
        }
    }

    updateDashboardCards() {
        // Actualizar el card de tareas por calificar
        const tareasCard = document.querySelector('.card:nth-child(1) .card-value');
        if (tareasCard) {
            tareasCard.textContent = this.stats.tareasPendientes;
        }

        // Actualizar el card de alumnos inscritos
        const alumnosCard = document.querySelector('.card:nth-child(2) .card-value');
        if (alumnosCard) {
            alumnosCard.textContent = this.stats.alumnosInscritos;
        }

        // Actualizar el card de proyectos en curso
        const proyectosCard = document.querySelector('.card:nth-child(3) .card-value');
        if (proyectosCard) {
            proyectosCard.textContent = this.stats.proyectosCurso;
        }

        console.log('üìà Dashboard actualizado:', this.stats);
    }
}

// Inicializar dashboard cuando la p√°gina cargue
document.addEventListener('DOMContentLoaded', function() {
    const dashboard = new DashboardManager();
    dashboard.loadDashboardData();
});